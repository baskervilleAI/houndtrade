<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Test Simple Chart.js Financial</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .chart-container {
            width: 100%;
            height: 500px;
            background: #111;
            border: 2px solid #333;
            margin: 20px 0;
            position: relative;
        }
        #status {
            background: #222;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #444;
        }
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test B√°sico Chart.js Financial</h1>
        
        <div id="status">
            <div class="loading">‚è≥ Cargando librer√≠as...</div>
        </div>

        <div class="chart-container">
            <canvas id="chart" width="800" height="400"></canvas>
        </div>
    </div>

    <!-- Librer√≠as desde CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.2.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0"></script>

    <script>
        console.clear();
        console.log('üöÄ Iniciando test Chart.js Financial...');
        
        let chart = null;
        const statusEl = document.getElementById('status');
        
        // Datos simplificados
        const candleData = [
            { x: Date.now() - 7*60*60*1000, o: 100, h: 110, l: 95, c: 105 },
            { x: Date.now() - 6*60*60*1000, o: 105, h: 115, l: 100, c: 108 },
            { x: Date.now() - 5*60*60*1000, o: 108, h: 112, l: 102, c: 110 },
            { x: Date.now() - 4*60*60*1000, o: 110, h: 118, l: 107, c: 115 },
            { x: Date.now() - 3*60*60*1000, o: 115, h: 120, l: 110, c: 112 },
            { x: Date.now() - 2*60*60*1000, o: 112, h: 117, l: 108, c: 116 },
            { x: Date.now() - 1*60*60*1000, o: 116, h: 122, l: 114, c: 120 },
            { x: Date.now(), o: 120, h: 125, l: 118, c: 122 }
        ];
        
        function updateStatus(message, isError = false) {
            statusEl.innerHTML = `<div style="color: ${isError ? '#ff4444' : '#00ff88'}">${message}</div>`;
            console.log(message);
        }
        
        function checkDependencies() {
            updateStatus('üîç Verificando dependencias...');
            
            if (typeof Chart === 'undefined') {
                updateStatus('‚ùå Chart.js no est√° disponible', true);
                return false;
            }
            
            if (typeof ChartFinancial === 'undefined') {
                updateStatus('‚ùå Chart.js Financial no est√° disponible', true);
                return false;
            }
            
            updateStatus('‚úÖ Todas las dependencias est√°n cargadas');
            return true;
        }
        
        function createChart() {
            updateStatus('üìä Creando gr√°fico de velas japonesas...');
            
            try {
                // Registrar controladores
                Chart.register(
                    ChartFinancial.CandlestickController,
                    ChartFinancial.CandlestickElement
                );
                
                const canvas = document.getElementById('chart');
                const ctx = canvas.getContext('2d');
                
                const config = {
                    type: 'candlestick',
                    data: {
                        datasets: [{
                            label: 'Test Candlesticks',
                            data: candleData,
                            borderColor: {
                                up: '#00ff00',
                                down: '#ff0000',
                                unchanged: '#999999'
                            },
                            backgroundColor: {
                                up: 'rgba(0, 255, 0, 0.1)',
                                down: 'rgba(255, 0, 0, 0.1)',
                                unchanged: 'rgba(153, 153, 153, 0.1)'
                            }
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                type: 'time',
                                time: {
                                    unit: 'hour'
                                },
                                grid: {
                                    color: '#333'
                                },
                                ticks: {
                                    color: '#fff'
                                }
                            },
                            y: {
                                type: 'linear',
                                grid: {
                                    color: '#333'
                                },
                                ticks: {
                                    color: '#fff'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#fff'
                                }
                            }
                        }
                    }
                };
                
                chart = new Chart(ctx, config);
                
                updateStatus(`‚úÖ Gr√°fico creado con ${candleData.length} velas`);
                
                // Informaci√≥n adicional
                setTimeout(() => {
                    const chartInfo = `
                        <div>‚úÖ Gr√°fico creado con ${candleData.length} velas</div>
                        <div>üìä Tipo: ${chart.config.type}</div>
                        <div>üéØ Chart.js v${Chart.version}</div>
                        <div>üí∞ Rango: $95 - $125</div>
                    `;
                    statusEl.innerHTML = chartInfo;
                }, 1000);
                
            } catch (error) {
                updateStatus(`‚ùå Error al crear gr√°fico: ${error.message}`, true);
                console.error('Error completo:', error);
            }
        }
        
        function init() {
            setTimeout(() => {
                if (checkDependencies()) {
                    createChart();
                } else {
                    updateStatus('üîÑ Reintentando en 1 segundo...');
                    setTimeout(init, 1000);
                }
            }, 100);
        }
        
        // Iniciar cuando la p√°gina est√© lista
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
        
        // Backup para asegurar inicializaci√≥n
        window.addEventListener('load', () => {
            if (!chart) {
                updateStatus('üîÑ Inicializaci√≥n de respaldo...');
                setTimeout(init, 500);
            }
        });
    </script>
</body>
</html>
